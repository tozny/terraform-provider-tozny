# tozny_realm_group Resource

Resource for provisioning a TozID Group with optional configuration such as attaching an Access policy to enable multi-party control.

This resource requires that the account username and password be supplied to the provider either via explicit provider settings or file based credentials.

## Example Usage

```hcl
# Include the Tozny Terraform provider
provider "tozny" {
  api_endpoint = "http://platform.local.tozny.com:8000"
  account_username = "test-emails-group+${random_string.account_username_salt.result}@tozny.com"
}

# Generate a random string for use in creating
# accounts across environments or executions conflict free
resource "random_string" "account_username_salt" {
  length = 8
  special = false
}

# Generate a random string for use in creating
# realms across environments or executions conflict free
resource "random_string" "random_realm_name" {
  length = 8
  special = false
}

# Local variables for defining where to store and find local Tozny client credentials
locals {
  tozny_client_credentials_filepath = "./tozny_client_credentials.json"
}

# A resource for provisioning a Tozny account using Terraform generated
# credentials that are saved to user specified filepath for reuse upon success.
resource "tozny_account" "autogenerated_tozny_account" {
  autogenerate_account_credentials = true
  client_credentials_save_filepath = local.tozny_client_credentials_filepath
}

# A resource for provisioning a TozID Realm
# using local file based credentials for a Tozny Client with permissions to manage Realms.
resource "tozny_realm" "my_organizations_realm" {
  # Block on and use client credentials generated from the provisioned account
  depends_on = [
    tozny_account.autogenerated_tozny_account,
  ]
  client_credentials_filepath = local.tozny_client_credentials_filepath
  realm_name = random_string.random_realm_name.result
  sovereign_name = "Administrator"
  mpc_enabled = true
}

# A resource to create a Role for approving access requests that is attached to the Group's access policy.
resource "tozny_realm_role" "mpc_approval_role" {
  depends_on = [
    tozny_realm.my_organizations_realm,
  ]
  client_credentials_filepath = local.tozny_client_credentials_filepath
  realm_name                = tozny_realm.my_organizations_realm.realm_name
  name                      = "approving_role"
  description               = "a role to approve access requests in a multi-party controlled group"
}

resource "tozny_realm_group" "my_first_group" {
  depends_on = [
    tozny_realm.my_organizations_realm
  ]
  client_credentials_filepath = local.tozny_client_credentials_filepath
  name = "My First Group"
  realm_name = tozny_realm.my_organizations_realm.realm_name
  // Only one access policy can be attached to a group at this time
  access_policy {
    approval_role_ids               = [tozny_realm_role.mpc_approval_role.realm_role_id]
    required_approvals              = 3
    maximum_access_duration_seconds = 1600
    plugin_type                     = "jira" // Tozny currently only supports "jira"
    plugin_id                       = "pluginID"
    plugin_mpc_flow_source          = "pluginSource"
  }
}

```

## Argument Reference

### Top-Level Arguments

- `client_credentials_filepath` - (Optional) The filepath to Tozny client credentials for the Terraform provider to use when provisioning this group. Omit if using `client_credentials_config`.
- `client_credentials_config` - (Optional) A JSON string containing Tozny client credentials for the provider to use when provisioning this group. Omit if using `client_credentials_filepath`.
- `group_id` - (Computed) Service defined unique identifier for the group.
- `realm_name` - (Required) The name of the realm with which to associate the group.
- `name` - (Required) User defined name for the group.
- `access_policy` - (Optional) The list of access policies to attach to the group.

### Access Policies Schema

- `access_policy_id` - (Computed) Server generated Id for the access policy
- `approval_role_ids` - (Required) The roles that can approve requests for groups with this access policy.
- `required_approvals` - (Optional) The number of approvals required for multi-party control of this group.
- `maximum_access_duration_seconds` - (Optional) The supported plugin type for the access policy (e.g. "jira").
- `plugin_type` - (Optional) The ID of the plugin.
- `plugin_mpc_flow_source` - (Optional) The ID of the source that managed MPC (e.g. the ID of a Jira Board).

## Attribute Reference

- `id` - Unique ID of the provisioned group.
