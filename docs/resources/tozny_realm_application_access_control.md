# tozny_realm_application_access_control Resource

A resource for provisioning Access to an Application for consumption, authentication and authorization of Realm Identities.

This resource requires that the account username and password be supplied to the provider either via explicit provider settings or file based credentials.

## Example Usage

```hcl
# Configure the Terraform runtime
terraform {
  required_version = ">= 0.13"
  required_providers {
    tozny = {
      # Pull signed provider binaries from
      # the Terraform hosted registry namespace
      # for Tozny registry.terraform.io/tozny
      source = "tozny/tozny"
      # Pin Tozny provider version
      version = ">=0.23.0"
    }
  }
}

# Include the Tozny Terraform provider
provider "tozny" {
  api_endpoint     = "http://platform.local.tozny.com:8000"
  account_username = "test-emails-group+${random_string.account_username_salt.result}@tozny.com"
}

# Generate a random string for use in creating
# accounts across environments or executions conflict free
resource "random_string" "account_username_salt" {
  length  = 8
  special = false
}

# A resource for provisioning a Tozny account using Terraform generated
# credentials that are saved to user specified filepath for reuse upon success.
resource "tozny_account" "autogenerated_tozny_account" {
  autogenerate_account_credentials = true
  persist_credentials_to           = "terraform"
}

# A resource for provisioning a TozID Realm
# using local file based credentials for a Tozny Client with permissions to manage Realms.
resource "tozny_realm" "my_organizations_realm" {
  # Block on and use client credentials generated from the provisioned account
  depends_on = [
    tozny_account.autogenerated_tozny_account,
  ]
  client_credentials_config = tozny_account.autogenerated_tozny_account.config
  realm_name                = "realmname"
  sovereign_name            = "Administrator"
}


resource "tozny_realm_group" "my_first_group" {
  depends_on = [
    tozny_realm.my_organizations_realm
  ]
  client_credentials_config = tozny_account.autogenerated_tozny_account.config
  name                      = "My First Group"
  realm_name                = tozny_realm.my_organizations_realm.realm_name
}

resource "tozny_realm_group" "my_second_group" {
  depends_on = [
    tozny_realm.my_organizations_realm
  ]
  client_credentials_config = tozny_account.autogenerated_tozny_account.config
  name                      = "My Second Group"
  realm_name                = tozny_realm.my_organizations_realm.realm_name
}
# A resource for creating an OIDC based realm application
resource "tozny_realm_application" "jenkins_oidc_application" {
  # Block on and use client credentials generated from the provisioned account
  depends_on = [
    tozny_realm.my_organizations_realm,
  ]
  client_credentials_config = tozny_account.autogenerated_tozny_account.config
  realm_name                = tozny_realm.my_organizations_realm.realm_name
  client_id                 = "jenkins-oid-app"
  name                      = "Jenkins"
  active                    = true
  protocol                  = "openid-connect"
}

# A resource for adding Access Control policy for a Application
resource "tozny_realm_application_access_control" "jenkins_application_access_control" {
  # Block on and use client credentials generated from the provisioned account, application creation and group creation
  depends_on = [
    tozny_realm.my_organizations_realm,
    tozny_realm_application.jenkins_oidc_application,
    tozny_realm_group.my_first_group,
    tozny_realm_group.my_second_group
  ]
  client_credentials_config = tozny_account.autogenerated_tozny_account.config
  realm_name                = tozny_realm.my_organizations_realm.realm_name
  application_id            = tozny_realm_application.jenkins_oidc_application.application_id
  enabled                   = true
  group {
    group_id           = tozny_realm_group.my_first_group.group_id
    extend_to_children = false

  }
  group {
    group_id           = tozny_realm_group.my_second_group.group_id
    extend_to_children = true

  }
}


```

## Argument Reference

### Top-Level Arguments

- `client_credentials_filepath` - (Optional) The filepath to Tozny client credentials for the provider to use when provisioning this resource. For this resource either this value or both `account_username` and `account_password` must be set on the provider. Omit if using `client_credentials_config`.
- `client_credentials_config` - (Optional) A JSON string containing Tozny client credentials for the provider to use when provisioning this resource. For this resource either this value or both `account_username` and `account_password` must be set on the provider. Omit if using `client_credentials_filepath`.
- `realm_name` - (Required) The name of the Realm to provision the Application for.
- `application_id` - (Required) Server defined unique identifier for the Application.
- `enabled` - (Required) Whether this application has managed access control.
- `group` - (Optional) Users within the selected groups can access this application.

### Group Schema

- `group_id` - (Required) Service defined unique identifier for the group.
- `extend_to_children` - (Optional) Wether SubGroups are able to access this application as well. Defaults to `false`.

## Attribute Reference

- `id` - Unique ID of the provisioned Access Control Policy.
